select  a.lead_createdby_date, a.super_region,  a.Lead_Type,a.rejection_reason,  count(distinct a.lead_id) lead_id,  a.Campaigns  from  (select  distinct convert(c.created_date_est, date) lead_createdby_date,  d.super_region,  case  when lead_stage_to in ('Marketing Rejected', 'Sales Rejected', 'Marketing Disqualified', 'Sales Disqualified')  and rejection_reason = 'Small Purchase' then 'Rejected Leads - Small Purchase'  when lead_stage_to in ('Marketing Disqualified', 'Sales Disqualified') then 'Disqualified Leads'  when lead_stage_to in ('Marketing Rejected', 'Sales Rejected', 'Marketing Disqualified', 'Sales Disqualified') then 'Rejected Leads'  when lead_stage_to in ('Marketing Accepted', 'Sales Accepted') then 'Accepted Leads'  end Lead_Type,  rejection_reason,  c.lead_id,  case  when campaign_record_type in ('Offer', 'Campaign')  and has_responded_flag = 'true' then 'Offers'  when campaign_record_type = 'Tactic'  and has_responded_flag = 'true' then 'Tactic'  end Campaigns  from  APL_VDB_SFDC_SALES.sfdc_lead_mngmnt_hist c  full outer join APL_VDB_SFDC_SALES.sfdc_lead d on  c.lead_id = d.lead_id  inner join APL_VDB_SFDC_SALES.sfdc_cmpgn_mmbr x on  c.lead_id = x.lead_id  inner join APL_VDB_SFDC_SALES.sfdc_cmpgn y on  x.campaign_id = y.campaign_id  where  extract(year  from  c.created_date_est) >= '2020') a group by a.lead_createdby_date, a.super_region,  a.Lead_Type,a.rejection_reason,  a.Campaigns
